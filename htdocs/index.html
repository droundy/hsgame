<html><head><title>Chat test</title>
<script type="text/javascript"
        src="http://pages.physics.cornell.edu/~shicks/jquery-1.3.2.min.js"
></script>
</head>
<body id="body-root" style="text-align:center">

<div id="chatarea" style="display:none">
<textarea id="chat" cols="80" rows="10" readonly></textarea>
<br/>
<input id="input" type="text" size="60"/>
<input id="say" type="submit" value="say"/>
</div>

<div id="loginarea">
Your name, please:
<input id="name" type="text" size="20"/>
<input id="login" type="submit" value="login"/>
</div>
<div id="test"></div>

<script>
  $(function(){
    var poll = function(){
      var name = $("#name").val();
      $.ajax({
        url: "/chat/poll",
        data: {u:name},
        complete: poll,
        dataType: "script"
      });
    }
    function login(){
      var name = $("#name").val();
      $("#loginarea").hide();
      $.ajax({
        url: "/chat/login",
        data: {u:name},
        complete: poll,
        dataType: "script"});
    }
    $("#login").bind("click",function(e){login()});
    function say(){
      var inp = $("#input");
      var txt = $("#chat");
      $.ajax({url:"/chat/say",data:{u:$("#name").val(),q:inp.attr("value")}});
      inp.val("");
    }

    $("#input").bind("keypress",function(e){if(e.which==13)say();});
    $("#name").bind("keypress",function(e){if(e.which==13)login();});
  });
</script>
